# Safe-Prescribed-Time-Controller-for-Wheeled-Mobile-Robots-using-Control-Barrier-Functions


This repository contains MATLAB code for a novel control strategy for wheeled mobile robots (WMRs), integrating a prescribed-time controller with a Control Barrier Function (CBF) as a safety filter. This approach ensures that the robot precisely tracks a desired trajectory within a user-defined finite time while rigorously avoiding obstacles and unsafe zones.

The methodology and implementation are based on the research article:
[cite_start]**"Safe prescribed time controller for wheeled mobile robots by using control barrier functions as a safety filter"** by Ali Alavi Nasab, Roozbeh Badiei, and Mohammad Hassan Asemani, published in *ISA Transactions*, Volume 162, 2025, Pages 119-133. [cite: 1, 8]

## Overview of the Control Methodology

The core of this control strategy lies in its dual-layer architecture:

1.  [cite_start]**Prescribed-Time (PT) Controller**: This outer-loop controller is designed to achieve trajectory tracking, ensuring that the robot's error dynamics converge to an equilibrium point at a user-defined "prescribed time" ($t_p$)[cite: 21, 33, 34, 35]. [cite_start]This means the robot will reach its desired position and orientation within a specified duration, regardless of its initial conditions[cite: 21, 35]. [cite_start]After the prescribed time, a proportional (P) controller takes over to maintain the system's errors at the equilibrium point[cite: 22, 264].
2.  [cite_start]**Control Barrier Function (CBF) Safety Filter**: Integrated as an inner-loop mechanism, the CBF acts as a safety filter[cite: 23, 65, 77]. [cite_start]It modifies the control inputs from the PT controller in real-time to guarantee that the robot always remains within a predefined safe region and avoids collisions with obstacles[cite: 23, 77, 200, 201]. [cite_start]This is achieved by formulating a Quadratic Program (QP) that minimizes deviations from the desired control inputs while satisfying the CBF-derived safety constraints[cite: 63, 65, 215].

[cite_start]This combined approach effectively balances performance (trajectory tracking within a prescribed time) and safety (obstacle avoidance)[cite: 65, 74].

## Kinematic Model of the Wheeled Mobile Robot

[cite_start]The WMR's motion is described by a nonholonomic kinematic model, assuming no slip and no sideways movement of the wheels[cite: 87]. [cite_start]The state vector is defined as $[x, y, \phi]^\top$, where $x$ and $y$ represent the robot's position and $\phi$ is its orientation[cite: 91]. [cite_start]The control inputs are linear velocity ($v$) and angular velocity ($\omega$)[cite: 92].

[cite_start]The kinematic equations are given by[cite: 89]:
[cite_start]$$\begin{bmatrix} \dot{x} \\ \dot{y} \\ \dot{\phi} \end{bmatrix} = \begin{bmatrix} \cos(\phi) & 0 \\ \sin(\phi) & 0 \\ 0 & 1 \end{bmatrix} \begin{bmatrix} \nu \\ \omega \end{bmatrix} \text{ [cite: 89]}$$

[cite_start]The reference trajectory $[x_r, y_r, \phi_r]^\top$ is generated by a virtual kinematic model with reference linear velocity $v_r$ and angular velocity $\omega_r$[cite: 94, 95]:
[cite_start]$$\begin{bmatrix} \dot{x}_r \\ \dot{y}_r \\ \dot{\phi}_r \end{bmatrix} = \begin{bmatrix} v_r \cos(\phi_r) \\ v_r \sin(\phi_r) \\ \omega_r \end{bmatrix} \text{ [cite: 95]}$$

[cite_start]Tracking errors in the robot's body frame are defined as[cite: 99]:
[cite_start]$$\begin{bmatrix} x_e \\ y_e \\ \phi_e \end{bmatrix} = \begin{bmatrix} \cos\phi & \sin\phi & 0 \\ -\sin\phi & \cos\phi & 0 \\ 0 & 0 & 1 \end{bmatrix} \begin{bmatrix} x_r-x \\ y_r-y \\ \phi_r-\phi \end{bmatrix} \text{ [cite: 99]}$$

## Control Design Details

### Prescribed-Time Controller
[cite_start]The prescribed-time controller for $t \in [0, t_p)$ is designed based on the error dynamics and given by[cite: 236, 240, 242]:
[cite_start]$$\omega = \frac{v_r \sin(\phi_e) - \frac{\gamma_1 y_e}{t-t_p}}{x_e} \text{ [cite: 236]}$$
[cite_start]$$v = v_r \cos(\phi_e) + \frac{y_e(v_r \sin(\phi_e) - \frac{\gamma_1 y_e}{t-t_p})}{x_e} - \frac{\gamma_2 x_e}{t-t_p} \text{ [cite: 240]}$$
where $\gamma_1$ and $\gamma_2$ are positive constants. [cite_start]For $t \ge t_p$, a proportional (P) controller is used to maintain stability and performance[cite: 264, 265]. [cite_start]Saturation functions are applied to restrict control inputs within practical limits[cite: 271].

### CBF Design and Safety Filter
[cite_start]The unsafe zone is defined as a circular region in the robot's environment[cite: 275]. [cite_start]The Control Barrier Function (CBF) for a circular obstacle with center $(x_c, y_c)$ and radius $r$ is defined as[cite: 276]:
[cite_start]$$h_{safe} = (x_{safe} - x_c)^2 + (y_{safe} - y_c)^2 - r^2 \text{ [cite: 276]}$$
[cite_start]where $x_{safe}$ and $y_{safe}$ are the states of the safe system[cite: 278]. [cite_start]For safety, $h_{safe} \ge 0$ (outside the obstacle)[cite: 279].

[cite_start]Since the relative degree of $h_{safe}$ with respect to the control input is two, Lemma 2 Part (b) from the paper is applied[cite: 282, 283]. [cite_start]The safe control input $u_{cbf}$ is obtained by solving the following Quadratic Program (QP) at each time step[cite: 223, 287]:
[cite_start]$$u_{safe} := \arg \min_{u \in U} \frac{1}{2} ||u - k_p(x)||^2 \text{ [cite: 223]}$$
[cite_start]$$\text{s.t.} \quad \ddot{h}(x) \ge -\alpha^2 h(x) - 2\alpha \dot{h}(x) \text{ [cite: 224]}$$
[cite_start]where $k_p(x)$ is the control input from the prescribed-time/proportional controller, and $\alpha$ is a positive constant[cite: 226, 294]. [cite_start]This QP ensures that the safety constraint is satisfied while minimally altering the desired control commands[cite: 202, 297].

## Code Structure

The MATLAB code is organized into a main script and several functions:

* **Main Script**: `main.m` (or similar, typically the top-level script) orchestrates the simulation. It defines obstacle parameters, initial conditions, time span, and loops through different `alpha` values for simulation. It also handles plotting of results.
* **`main_system(t, states, v_r, omega_r, alpha)`**: This is the core ODE function passed to the `euler` solver. It defines the kinematics of the reference, unsafe actual, and safe actual robot systems. It calculates errors, computes desired control inputs using `controller`, sets up and solves the CBF-QP using YALMIP, and returns the derivatives of all state variables (`dydt`).
* **`v_refence(t)`**: Returns the constant reference linear velocity.
* **`omega_refence(t)`**: Returns the constant reference angular velocity.
* **`controller(gamma_1, gamma_2, v_r, omega_r, x_e, y_e, phi_e, t)`**: Implements the switching control law (prescribed-time for $t < t_p$ and proportional for $t \ge t_p$) and applies saturation limits to the control outputs.
* **`calculate_control_inputs(...)`**: A helper function to compute tracking errors and retrieve control inputs from the `controller` for analysis purposes.
* **`controlInputs_cal(x, t, phi)`**: Calculates linear and angular velocities by numerically differentiating the robot's position and orientation data.
* **`euler(odefun, tspan, y0)`**: A custom implementation of the Euler numerical integration method to solve the ODEs.

## Simulation Results

The provided code generates plots illustrating:
* **System states over time**: Shows the convergence of the robot's x, y, and phi states to the reference trajectory, for both unsafe and safe (CBF-controlled) cases, across different alpha values.
* **Reference vs. Actual Paths**: Visualizes the 2D trajectories of the robot, demonstrating how the CBF-equipped system successfully avoids the defined circular obstacle while tracking the reference path.
* **Control Inputs**: Displays the linear ($v$) and angular ($\omega$) velocity commands over time, including the saturation limits and how the CBF modifies these inputs to ensure safety.

[cite_start]The simulations demonstrate the scheme's capability to reach the equilibrium point regardless of initial conditions and user-defined prescribed time, while consistently maintaining safety within the defined set space[cite: 25, 709].

## Requirements

* [cite_start]MATLAB (R2024a or newer is recommended, as used in the paper for simulations [cite: 362]).
* [cite_start]YALMIP toolbox (for solving the Quadratic Program in the CBF safety filter)[cite: 363].

## Usage

1.  Clone this repository to your local machine.
2.  Ensure MATLAB and the YALMIP toolbox are correctly installed and configured.
3.  Open the main script (e.g., `main.m`) in MATLAB.
4.  Run the script. The simulation will execute, and plots will be generated, showcasing the performance of the safe prescribed-time controller.

## Future Work

[cite_start]As highlighted in the paper, future improvements could include[cite: 1024, 1025]:
* Developing adaptive control laws for the `alpha` parameter and controller gains to enhance feasibility and performance in real-time applications.
* [cite_start]Conducting more comprehensive Hardware-in-the-Loop (HIL) simulations and rigorous real-world validation[cite: 1026].

## Contact

For any questions or collaborations, please refer to the authors listed in the paper:
* [cite_start]Ali Alavi Nasab (ali443@hafez.shirazu.ac.ir) [cite: 46]
* [cite_start]Roozbeh Badiei (roozbeh_badie@alumni.iust.ac.ir) [cite: 46]
* [cite_start]Mohammad Hassan Asemani (asemani@shirazu.ac.ir) [cite: 46]

# Safe-Prescribed-Time-Controller-for-Wheeled-Mobile-Robots-using-Control-Barrier-Functions


This repository contains MATLAB code for a novel control strategy for wheeled mobile robots (WMRs), integrating a prescribed-time controller with a Control Barrier Function (CBF) as a safety filter. This approach ensures that the robot precisely tracks a desired trajectory within a user-defined finite time while rigorously avoiding obstacles and unsafe zones.

The methodology and implementation are based on the research article:
**"Safe prescribed time controller for wheeled mobile robots by using control barrier functions as a safety filter"** by Ali Alavi Nasab, Roozbeh Badiei, and Mohammad Hassan Asemani, published in *ISA Transactions*, Volume 162, 2025, Pages 119-133.

## Overview of the Control Methodology

The core of this control strategy lies in its dual-layer architecture:

1. **Prescribed-Time (PT) Controller**: This outer-loop controller is designed to achieve trajectory tracking, ensuring that the robot's error dynamics converge to an equilibrium point at a user-defined "prescribed time" ($t_p$). This means the robot will reach its desired position and orientation within a specified duration, regardless of its initial conditions. After the prescribed time, a proportional (P) controller takes over to maintain the system's errors at the equilibrium point.
2. **Control Barrier Function (CBF) Safety Filter**: Integrated as an inner-loop mechanism, the CBF acts as a safety filter. It modifies the control inputs from the PT controller in real-time to guarantee that the robot always remains within a predefined safe region and avoids collisions with obstacles. This is achieved by formulating a Quadratic Program (QP) that minimizes deviations from the desired control inputs while satisfying the CBF-derived safety constraints. This combined approach effectively balances performance (trajectory tracking within a prescribed time) and safety (obstacle avoidance).

---

## Kinematic Model of the Wheeled Mobile Robot

The WMR's motion is described by a nonholonomic kinematic model, assuming no slip and no sideways movement of the wheels. The state vector is defined as $\[x, y, \phi]^\top\$, where \$x\$ and \$y\$ represent the robot's position and \$\phi\$ is its orientation. The control inputs are linear velocity (\$v\$) and angular velocity (\$\omega\$).

The kinematic equations are given by:

```math
\begin{bmatrix} \dot{x} \\ \dot{y} \\ \dot{\phi} \end{bmatrix} = 
\begin{bmatrix} \cos(\phi) & 0 \\ \sin(\phi) & 0 \\ 0 & 1 \end{bmatrix}
\begin{bmatrix} \nu \\ \omega \end{bmatrix}
```

The reference trajectory $\[x\_r, y\_r, \phi\_r]^\top\$ is generated by a virtual kinematic model with reference linear velocity \$v\_r\$ and angular velocity \$\omega\_r\$:

```math
\begin{bmatrix} \dot{x}_r \\ \dot{y}_r \\ \dot{\phi}_r \end{bmatrix} = 
\begin{bmatrix} v_r \cos(\phi_r) \\ v_r \sin(\phi_r) \\ \omega_r \end{bmatrix}
```

Tracking errors in the robot's body frame are defined as:

```math
\begin{bmatrix} x_e \\ y_e \\ \phi_e \end{bmatrix} = 
\begin{bmatrix} \cos\phi & \sin\phi & 0 \\ -\sin\phi & \cos\phi & 0 \\ 0 & 0 & 1 \end{bmatrix}
\begin{bmatrix} x_r-x \\ y_r-y \\ \phi_r-\phi \end{bmatrix}
```

---

## Control Design Details

### Prescribed-Time Controller

The prescribed-time controller for \$t \in \[0, t\_p)\$ is designed based on the error dynamics and is given by:

```math
\omega = \frac{v_r \sin(\phi_e) - \frac{\gamma_1 y_e}{t - t_p}}{x_e}
```

```math
v = v_r \cos(\phi_e) + \frac{y_e(v_r \sin(\phi_e) - \frac{\gamma_1 y_e}{t - t_p})}{x_e} - \frac{\gamma_2 x_e}{t - t_p}
```

where \$\gamma\_1\$ and \$\gamma\_2\$ are positive constants.

For \$t \ge t\_p\$, a proportional (P) controller is used to maintain stability and performance. Saturation functions are applied to restrict control inputs within practical limits.

---

### CBF Design and Safety Filter

The unsafe zone is defined as a circular region in the robot's environment. The Control Barrier Function (CBF) for a circular obstacle with center \$(x\_c, y\_c)\$ and radius \$r\$ is defined as:

```math
h_{safe} = (x_{safe} - x_c)^2 + (y_{safe} - y_c)^2 - r^2
```

where \$x\_{safe}\$ and \$y\_{safe}\$ are the states of the safe system. For safety, \$h\_{safe} \ge 0\$ (i.e., outside the obstacle).

Since the relative degree of \$h\_{safe}\$ with respect to the control input is two, the safe control input \$u\_{cbf}\$ is obtained by solving the following Quadratic Program (QP) at each time step:

```math
u_{safe} := \arg \min_{u \in U} \frac{1}{2} ||u - k_p(x)||^2
```

Subject to:

```math
\ddot{h}(x) \ge -\alpha^2 h(x) - 2\alpha \dot{h}(x)
```

where \$k\_p(x)\$ is the control input from the prescribed-time or proportional controller, and \$\alpha\$ is a positive constant. This QP ensures that the safety constraint is satisfied while minimally altering the desired control commands.

---

## Code Structure

The MATLAB code is organized into a main script and several functions:

* **Main Script**: `main.m` orchestrates the simulation. It defines obstacle parameters, initial conditions, time span, and loops through different `alpha` values. It also handles plotting.
* **`main_system(t, states, v_r, omega_r, alpha)`**: Core ODE function passed to the Euler solver. It defines the kinematics, computes tracking errors, calculates desired control inputs, and solves the CBF-QP using YALMIP.
* **`v_refence(t)`**: Returns the constant reference linear velocity.
* **`omega_refence(t)`**: Returns the constant reference angular velocity.
* **`controller(gamma_1, gamma_2, v_r, omega_r, x_e, y_e, phi_e, t)`**: Implements the switching control law (prescribed-time for \$t < t\_p\$ and proportional for \$t \ge t\_p\$) and applies saturation.
* **`calculate_control_inputs(...)`**: Computes tracking errors and retrieves control inputs from the controller for analysis.
* **`controlInputs_cal(x, t, phi)`**: Calculates velocities by numerically differentiating position and orientation.
* **`euler(odefun, tspan, y0)`**: Custom implementation of the Euler method for numerical integration.


---

## Requirements

* MATLAB (R2024a or newer is recommended).
* YALMIP toolbox (for solving the CBF Quadratic Program).

---

## Usage

1. Clone this repository to your local machine.
2. Ensure MATLAB and the YALMIP toolbox are installed and configured.
3. Open the main script (e.g., `main.m`) in MATLAB.
4. Run the script. The simulation will execute, and plots will be generated, showing the performance of the safe prescribed-time controller.

---

Let me know if you'd like this exported as a `.md` file or integrated into a GitHub `README.md`.

## Contact

For any questions or collaborations, please refer to the authors listed in the paper:
* [cite_start]Ali Alavi Nasab (ali443@hafez.shirazu.ac.ir) [cite: 46]
* [cite_start]Roozbeh Badiei (roozbeh_badie@alumni.iust.ac.ir) [cite: 46]
* [cite_start]Mohammad Hassan Asemani (asemani@shirazu.ac.ir) [cite: 46]
